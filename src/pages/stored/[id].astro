---
import type { GetStaticPaths, InferGetStaticParamsType } from 'astro'
import { stored } from '../stored.json'
import Layout from '../../layouts/Layout.astro'
import { getMediaUrls } from '../../helper/getMediaUrls'
import { Box, Container, styled } from '../../../styled-system/react'
const A = styled.a
const H1 = styled.h1
const Img = styled.img

export const getStaticPaths = (() => {
  return stored.map((item) => ({ params: { id: item.id } }))
}) satisfies GetStaticPaths

const { id } = Astro.params as InferGetStaticParamsType<typeof getStaticPaths>
const item = stored.find((item) => item.id === id)!
const media = getMediaUrls(item)
---

  <Layout>
    <Container h="100dvh" display="flex" flexDirection="column" justifyContent="space-between">
      <Box display="flex" h="80dvh" placeContent="center">
        <Box>
          <A href="/" fontSize="4xl">
            x
          </A>
          <Box height="100%" p="25px" style={{ background: `url(${media.pixelUrl})` }}>
            <Img
              data-pixel={media.pixelUrl}
              src={media.cdnUrl}
              alt={item.title}
              height="100%"
              objectFit="contain"
              boxShadow="xl"
            />
          </Box>
          <A href={`https://www.reddit.com/${item.id}`} fontSize="xl">
            [source]
          </A>
        </Box>
      </Box>
      <H1 textAlign="center">{item.title}</H1>
    </Container>
    <script>
      import mediumZoom from 'https://esm.sh/medium-zoom@1.0.8'
      const img = document.querySelector('img')
      const  pixel = img.getAttribute('data-pixel')
      mediumZoom('img', {
        background: `url(${pixel})`,
      })
    </script>
  </Layout>
